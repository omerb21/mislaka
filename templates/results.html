{% extends "base.html" %}

{% block content %}
<div class="container-fluid mt-3">
    <div class="card table-card shadow-sm {{ 'wide-card' if wide_layout else '' }}">
        <div class="card-header d-flex justify-content-between align-items-center">
            <div class="header-title">
                <h5 class="mb-1">תוצאות עיבוד קבצי מסלקה</h5>
                <div class="subtitle">סה"כ רשומות: {{ record_count }}</div>
            </div>
            <div class="header-actions">
                <a href="{{ url_for('export') }}" class="btn btn-success btn-sm">
                    <i class="bi bi-file-earmark-excel"></i>
                    ייצוא לאקסל
                </a>
                <a href="{{ url_for('upload_file') }}" class="btn btn-outline-secondary btn-sm">
                    <i class="bi bi-arrow-right"></i>
                    חזור להעלאה
                </a>
            </div>
        </div>

        <div class="table-wrapper {{ 'wide-wrapper' if wide_layout else '' }}">
            <table class="pension-table {{ 'wide-table' if wide_layout else '' }}" id="pensionTable">
                <thead>
                    <tr class="header-primary">
                        {% for col in df_columns %}
                            <th>{{ col }}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for row in df_values %}
                        <tr>
                            {% for cell in row %}
                                {% set value = cell if cell is not none else '' %}
                                <td class="{{ 'numeric-cell' if loop.index0 in numeric_column_indexes else 'text-cell' }}" title="{{ value }}">
                                    {{ value }}
                                </td>
                            {% endfor %}
                        </tr>
                    {% endfor %}
                </tbody>
                <tfoot>
                    <tr class="totals-row">
                        {% for cell in totals_row %}
                            <td class="{{ 'numeric-cell' if loop.index0 in numeric_column_indexes else 'text-cell' }}" title="{{ cell }}">{{ cell }}</td>
                        {% endfor %}
                    </tr>
                </tfoot>
            </table>
        </div>

        <div class="card-footer d-flex justify-content-between align-items-center">
            <div class="footer-info">
                <span class="label">עודכן לאחרונה:</span>
                <span class="value">{{ timestamp }}</span>
            </div>
            <div class="legend">
                <span class="legend-item">
                    <span class="legend-color legend-total"></span>
                    שורת סיכום
                </span>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const table = document.getElementById('pensionTable');
        if (!table) {
            return;
        }

        // zebra striping handled via CSS nth-child
        table.querySelectorAll('tbody tr').forEach((row) => {
            row.addEventListener('mouseenter', () => row.classList.add('hover'));
            row.addEventListener('mouseleave', () => row.classList.remove('hover'));
        });
    });
</script>
{% endblock %}

{% block extra_styles %}
<style>
    .table-card {
        border: none;
        border-radius: 12px;
        overflow: hidden;
        background-color: #ffffff;
    }

    .table-card .card-header {
        background: linear-gradient(90deg, #0d6efd 0%, #0a58ca 100%);
        color: #ffffff;
        padding: 1rem 1.5rem;
    }

    .table-card .header-title h5 {
        font-weight: 600;
        margin: 0;
    }

    .table-card .subtitle {
        font-size: 0.85rem;
        opacity: 0.85;
    }

    .header-actions .btn {
        margin-inline-start: 0.5rem;
        display: inline-flex;
        align-items: center;
        gap: 0.35rem;
    }

    .wide-card {
        width: 100%;
        max-width: 100%;
        margin: 0 auto;
    }

    .table-wrapper {
        overflow-x: auto;
        scrollbar-width: thin;
    }

    .table-wrapper::-webkit-scrollbar {
        height: 8px;
    }

    .table-wrapper::-webkit-scrollbar-thumb {
        background-color: rgba(13, 110, 253, 0.35);
        border-radius: 4px;
    }

    .pension-table {
        width: 100%;
        min-width: 1300px;
        border-collapse: separate;
        border-spacing: 0;
        table-layout: auto;
        direction: rtl;
        text-align: right;
        font-size: 0.8rem;
        background-color: #ffffff;
    }

    .wide-wrapper {
        width: 100%;
    }

    .wide-table {
        min-width: 1600px;
    }

    .pension-table thead th {
        background-color: #f3f6fb;
        color: #0a4271;
        font-weight: 600;
        padding: 4px 10px;
        border-bottom: 2px solid #d9e2ef;
        border-inline-end: 1px solid #e3e7ed;
        white-space: normal;
        text-align: center;
        position: sticky;
        top: 0;
        z-index: 5;
        line-height: 1.3;
        word-break: keep-all;
    }

    .pension-table thead th:first-child {
        border-inline-start: none;
    }

    .pension-table tbody tr {
        border-bottom: 1px solid #eff3f8;
        transition: background-color 0.2s ease;
    }

    .pension-table tbody tr:nth-child(odd) {
        background-color: #fbfcfe;
    }

    .pension-table tbody tr:nth-child(even) {
        background-color: #f6f9ff;
    }

    .pension-table tbody tr:hover,
    .pension-table tbody tr.hover {
        background-color: #e4f0ff;
    }

    .pension-table td {
        padding: 4px 10px;
        border-inline-end: 1px solid #edf0f5;
        border-bottom: 1px solid #eff3f8;
        vertical-align: middle;
        white-space: nowrap;
        line-height: 1.2;
    }

    .pension-table td:last-child,
    .pension-table th:last-child {
        border-inline-end: none;
    }

    .pension-table .numeric-cell {
        font-family: 'Assistant', 'Rubik', sans-serif;
        text-align: center;
        direction: ltr;
        color: #0c3050;
        white-space: nowrap;
        min-width: 180px;
    }

    .pension-table .text-cell {
        color: #12263f;
        white-space: nowrap;
        min-width: 160px;
    }

    .totals-row {
        background-color: #ffe8cc;
        border-top: 2px solid #f2c57c;
        font-weight: 600;
        color: #604214;
    }

    .totals-row td {
        padding: 12px 10px;
        border-inline-end: 1px solid #f3cf94;
    }

    .totals-row td:first-child {
        text-align: center;
    }

    .totals-row td.numeric-cell {
        text-align: center;
    }

    .card-footer {
        background-color: #f9fbfd;
        border-top: 1px solid #e6ecf4;
        padding: 0.85rem 1.5rem;
    }

    .card-footer .footer-info .label {
        font-weight: 500;
        color: #0a4271;
    }

    .card-footer .footer-info .value {
        margin-inline-start: 0.35rem;
        color: #2d4a66;
    }

    .legend {
        display: inline-flex;
        align-items: center;
        gap: 0.75rem;
        font-size: 0.85rem;
        color: #51647c;
    }

    .legend-item {
        display: inline-flex;
        align-items: center;
        gap: 0.35rem;
    }

    .legend-color {
        width: 14px;
        height: 14px;
        border-radius: 3px;
        display: inline-block;
    }

    .legend-total {
        background-color: #ffe8cc;
        border: 1px solid #f2c57c;
    }

    @media (max-width: 992px) {
        .header-actions {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
    }

    @media (max-width: 768px) {
        .pension-table {
            font-size: 0.85rem;
        }

        .pension-table thead th,
        .pension-table td {
            padding: 8px 6px;
        }
    }
</style>
{% endblock %}
